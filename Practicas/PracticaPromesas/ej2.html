<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ej2</title>
</head>
<body>
    <h1>Lista de personas</h1>

    <form>
        <label for="name">Nombre: </label>
        <input type="text" id="name" name="name"><br>
        <label for="phone">Número de teléfono: </label>
        <input type="text" id="phone" name="phone"><br>
        <label for="age">Edad: </label>
        <input type="text" id="age" name="age"><br>

        <button type="button" id="eliminar">Eliminar Persona</button>
        <button type="button" id="añadir">Añadir Persona</button>
    </form>
    <p id="msg"></p>
    <script>
        let data = [
        {name: "Nacho", phone: "966112233", age: 40},
        {name: "Ana", phone: "911223344", age: 35},
        {name: "Mario", phone: "611998877", age: 15},
        {name: "Laura", phone: "633663366", age: 17}
        ];
        newPerson ({name: "Juan", phone: "965661564", age: 60});
        newPerson ({name: "Rodolfo", phone: "633663366", age: 20});
        deletePerson ("966112233");
        deletePerson ("123456789");
        console.log (data);

        const name = document.getElementById('name');
        const phone = document.getElementById('phone');
        const age = document.getElementById('age');
        const borrar = document.getElementById('eliminar');
        const anadir = document.getElementById('añadir');
        const msg = document.getElementById("msg");

        function newPerson(name, phone, age) {
                return new Promise((resolve, reject) => {
                    const exists = data.some(p => p.phone === phone);

                        if(exists){
                            reject(Error('El telelfono introducido ya existe'));
                        }else{
                            data.push({ name, phone, age});
                            resolve('Persona añadida con éxito');
                        }
                    
                });
        }

        function deletePerson(phone) {
                return new Promise((resolve, reject) => {
                    const index = data.findIndex(p => p.phone === phone);
                        if(index === -1){
                            reject(Error('El telelfono introducido no existe'));
                        }else{
                            data.splice(index, 1);
                            resolve('Persona eliminada con éxito');
                        }
                    
                });
        }

        anadir.addEventListener(('click', () =>{
            newPerson(name.value, phone.value, age.value)
                .then(res => { msg.textContent = res; })
                .catch(err => { msg.textContent = err; });
        }));

        borrar.addEventListener(('click', () => {
            deletePerson(phone.value)
                .then(res => { msg.textContent = res; })
                .catch(err => { msg.textContent = err; });
        }));

    </script>
</body>
</html>